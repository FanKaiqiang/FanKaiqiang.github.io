<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【翻译】从 Mobx 3 迁移到 Mobx 4 | Franko&#39;s Blog</title>
    <meta name="description" content="长江一帆远，落日五湖春。">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.82618647.css" as="style"><link rel="preload" href="/assets/js/app.20586f85.js" as="script"><link rel="preload" href="/assets/js/3.a975d71c.js" as="script"><link rel="preload" href="/assets/js/1.f9715dde.js" as="script"><link rel="preload" href="/assets/js/117.2b92a260.js" as="script"><link rel="prefetch" href="/assets/js/10.3713fa2b.js"><link rel="prefetch" href="/assets/js/100.c7e8673f.js"><link rel="prefetch" href="/assets/js/101.29a59833.js"><link rel="prefetch" href="/assets/js/102.3fbd0f95.js"><link rel="prefetch" href="/assets/js/103.72c6e9b5.js"><link rel="prefetch" href="/assets/js/104.f6f27012.js"><link rel="prefetch" href="/assets/js/105.0d66958f.js"><link rel="prefetch" href="/assets/js/106.290db28e.js"><link rel="prefetch" href="/assets/js/107.e20e3803.js"><link rel="prefetch" href="/assets/js/108.cd45cee0.js"><link rel="prefetch" href="/assets/js/109.4ba3d58f.js"><link rel="prefetch" href="/assets/js/11.3f5de7ee.js"><link rel="prefetch" href="/assets/js/110.0d55c579.js"><link rel="prefetch" href="/assets/js/111.3648d92a.js"><link rel="prefetch" href="/assets/js/112.cf39ecb8.js"><link rel="prefetch" href="/assets/js/113.6f2fdbc4.js"><link rel="prefetch" href="/assets/js/114.77c92b08.js"><link rel="prefetch" href="/assets/js/115.0656b5e6.js"><link rel="prefetch" href="/assets/js/116.80cf31f3.js"><link rel="prefetch" href="/assets/js/118.c06968f3.js"><link rel="prefetch" href="/assets/js/119.20ab4e08.js"><link rel="prefetch" href="/assets/js/12.19e53560.js"><link rel="prefetch" href="/assets/js/120.97d79ae7.js"><link rel="prefetch" href="/assets/js/121.f6da62ca.js"><link rel="prefetch" href="/assets/js/122.859caf01.js"><link rel="prefetch" href="/assets/js/13.dda8f215.js"><link rel="prefetch" href="/assets/js/14.2a592289.js"><link rel="prefetch" href="/assets/js/15.4925e3a4.js"><link rel="prefetch" href="/assets/js/16.0f840892.js"><link rel="prefetch" href="/assets/js/17.3e801416.js"><link rel="prefetch" href="/assets/js/18.b4d3a92e.js"><link rel="prefetch" href="/assets/js/19.f9cee7a0.js"><link rel="prefetch" href="/assets/js/20.3f33780e.js"><link rel="prefetch" href="/assets/js/21.ed566f24.js"><link rel="prefetch" href="/assets/js/22.94f8e887.js"><link rel="prefetch" href="/assets/js/23.fb38ed6e.js"><link rel="prefetch" href="/assets/js/24.dd36a8c2.js"><link rel="prefetch" href="/assets/js/25.bb6cacf5.js"><link rel="prefetch" href="/assets/js/26.c86a26fa.js"><link rel="prefetch" href="/assets/js/27.2dd1516a.js"><link rel="prefetch" href="/assets/js/28.83a01027.js"><link rel="prefetch" href="/assets/js/29.fcd25cd4.js"><link rel="prefetch" href="/assets/js/30.a1c1c82d.js"><link rel="prefetch" href="/assets/js/31.274c9b5e.js"><link rel="prefetch" href="/assets/js/32.f75d4ae9.js"><link rel="prefetch" href="/assets/js/33.1e4d92da.js"><link rel="prefetch" href="/assets/js/34.4ef7ac99.js"><link rel="prefetch" href="/assets/js/35.4f47ea1f.js"><link rel="prefetch" href="/assets/js/36.f1911a7c.js"><link rel="prefetch" href="/assets/js/37.b562ea4c.js"><link rel="prefetch" href="/assets/js/38.b862a71d.js"><link rel="prefetch" href="/assets/js/39.0a74782b.js"><link rel="prefetch" href="/assets/js/4.46f5c0e2.js"><link rel="prefetch" href="/assets/js/40.f75bdd02.js"><link rel="prefetch" href="/assets/js/41.62a05ca3.js"><link rel="prefetch" href="/assets/js/42.1a733cf6.js"><link rel="prefetch" href="/assets/js/43.7506e026.js"><link rel="prefetch" href="/assets/js/44.568d2265.js"><link rel="prefetch" href="/assets/js/45.50e5cd0c.js"><link rel="prefetch" href="/assets/js/46.2c3c32c9.js"><link rel="prefetch" href="/assets/js/47.f9a54e6b.js"><link rel="prefetch" href="/assets/js/48.32da44eb.js"><link rel="prefetch" href="/assets/js/49.df6b0b62.js"><link rel="prefetch" href="/assets/js/5.bb6aabf2.js"><link rel="prefetch" href="/assets/js/50.52d40ed6.js"><link rel="prefetch" href="/assets/js/51.e7a7badb.js"><link rel="prefetch" href="/assets/js/52.6a20c4e8.js"><link rel="prefetch" href="/assets/js/53.2747af5b.js"><link rel="prefetch" href="/assets/js/54.02396d0d.js"><link rel="prefetch" href="/assets/js/55.7b929339.js"><link rel="prefetch" href="/assets/js/56.f24df74e.js"><link rel="prefetch" href="/assets/js/57.a39d5e97.js"><link rel="prefetch" href="/assets/js/58.b13862f5.js"><link rel="prefetch" href="/assets/js/59.b2ef3cb1.js"><link rel="prefetch" href="/assets/js/6.9a323443.js"><link rel="prefetch" href="/assets/js/60.3b294663.js"><link rel="prefetch" href="/assets/js/61.23d3575f.js"><link rel="prefetch" href="/assets/js/62.9c1cd3c8.js"><link rel="prefetch" href="/assets/js/63.4376c00d.js"><link rel="prefetch" href="/assets/js/64.59741dd5.js"><link rel="prefetch" href="/assets/js/65.8e59eee4.js"><link rel="prefetch" href="/assets/js/66.a07156ca.js"><link rel="prefetch" href="/assets/js/67.bad8de6a.js"><link rel="prefetch" href="/assets/js/68.348f3c6f.js"><link rel="prefetch" href="/assets/js/69.27403668.js"><link rel="prefetch" href="/assets/js/7.7376f609.js"><link rel="prefetch" href="/assets/js/70.e105d08d.js"><link rel="prefetch" href="/assets/js/71.3912c588.js"><link rel="prefetch" href="/assets/js/72.2e803182.js"><link rel="prefetch" href="/assets/js/73.698bb062.js"><link rel="prefetch" href="/assets/js/74.6eb02d59.js"><link rel="prefetch" href="/assets/js/75.5e85377b.js"><link rel="prefetch" href="/assets/js/76.a50ad35f.js"><link rel="prefetch" href="/assets/js/77.9923eba2.js"><link rel="prefetch" href="/assets/js/78.30d80868.js"><link rel="prefetch" href="/assets/js/79.b0633c2f.js"><link rel="prefetch" href="/assets/js/8.effb8ee5.js"><link rel="prefetch" href="/assets/js/80.1c7129b4.js"><link rel="prefetch" href="/assets/js/81.757e25f5.js"><link rel="prefetch" href="/assets/js/82.04a6c134.js"><link rel="prefetch" href="/assets/js/83.a5425512.js"><link rel="prefetch" href="/assets/js/84.478c64ab.js"><link rel="prefetch" href="/assets/js/85.e304024e.js"><link rel="prefetch" href="/assets/js/86.46d38efd.js"><link rel="prefetch" href="/assets/js/87.8ab01c2a.js"><link rel="prefetch" href="/assets/js/88.695a06d9.js"><link rel="prefetch" href="/assets/js/89.2b9afe77.js"><link rel="prefetch" href="/assets/js/9.a3297750.js"><link rel="prefetch" href="/assets/js/90.6dd7f214.js"><link rel="prefetch" href="/assets/js/91.891f6634.js"><link rel="prefetch" href="/assets/js/92.32bd7ffa.js"><link rel="prefetch" href="/assets/js/93.646030b0.js"><link rel="prefetch" href="/assets/js/94.2df43ae3.js"><link rel="prefetch" href="/assets/js/95.ca4e89a0.js"><link rel="prefetch" href="/assets/js/96.4b4fcf2a.js"><link rel="prefetch" href="/assets/js/97.705f40c5.js"><link rel="prefetch" href="/assets/js/98.3035542d.js"><link rel="prefetch" href="/assets/js/99.40877126.js">
    <link rel="stylesheet" href="/assets/css/0.styles.82618647.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Franko's Blog</span></a> <div class="links"><div class="color-picker"><a href="#" class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">Enable Dark Theme?</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/aboutMe.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/笔记.html" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/category/随笔.html" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/category/项目总结.html" class="nav-link"><i class="iconfont undefined"></i>
  项目总结
</a></li><li class="dropdown-item"><!----> <a href="/category/读书记录.html" class="nav-link"><i class="iconfont undefined"></i>
  读书记录
</a></li><li class="dropdown-item"><!----> <a href="/category/翻译.html" class="nav-link"><i class="iconfont undefined"></i>
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/category/关于我.html" class="nav-link"><i class="iconfont undefined"></i>
  关于我
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/FanKaiqiang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  源码
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/aboutMe.html" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/笔记.html" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/category/随笔.html" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/category/项目总结.html" class="nav-link"><i class="iconfont undefined"></i>
  项目总结
</a></li><li class="dropdown-item"><!----> <a href="/category/读书记录.html" class="nav-link"><i class="iconfont undefined"></i>
  读书记录
</a></li><li class="dropdown-item"><!----> <a href="/category/翻译.html" class="nav-link"><i class="iconfont undefined"></i>
  翻译
</a></li><li class="dropdown-item"><!----> <a href="/category/关于我.html" class="nav-link"><i class="iconfont undefined"></i>
  关于我
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/FanKaiqiang" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  源码
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>2020</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>九月</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>五月</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/2005/20200528A.html" class="sidebar-link">【翻译】MobX 4：更优秀、简易、快捷、轻便</a></li><li><a href="/2005/20200531A.html" class="active sidebar-link">【翻译】从 Mobx 3 迁移到 Mobx 4</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/2005/20200531A.html#变更概述" class="sidebar-link">变更概述</a></li><li class="sidebar-sub-header"><a href="/2005/20200531A.html#已删除的内容" class="sidebar-link">已删除的内容</a></li><li class="sidebar-sub-header"><a href="/2005/20200531A.html#已迁移的内容" class="sidebar-link">已迁移的内容</a></li><li class="sidebar-sub-header"><a href="/2005/20200531A.html#发生改变的内容" class="sidebar-link">发生改变的内容</a></li><li class="sidebar-sub-header"><a href="/2005/20200531A.html#其他改动" class="sidebar-link">其他改动</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>四月</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>三月</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>二月</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>一月</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2019</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2018</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>【翻译】从 Mobx 3 迁移到 Mobx 4</h1> <hr> <div data-v-b53d65a4><i class="iconfont reco-account" data-v-b53d65a4><span data-v-b53d65a4>广宇</span></i> <i class="iconfont reco-date" data-v-b53d65a4><span data-v-b53d65a4>2020-5-31</span></i> <!----> <i class="iconfont reco-tag tags" data-v-b53d65a4><span class="tag-item" data-v-b53d65a4>
      Mobx
    </span></i></div></div> <div class="content__default"><div class="tip custom-block"><p>今天是五月最后一天了，周六休息了一天感觉神清气爽。虽然其实休息也没怎么休息就是了，午睡也没有睡，因为准备租房了还去和总结看来两套房。但是只要没有在上班就感觉很爽。趁现在还有空就把还是之前翻译的一篇 Mobx 升级相关的文章搬运过来，充实一下这个月的博客数量吧。</p></div> <p>这篇文章是 Mobx 作者写的一篇关于 Mobx 3 升级到 Mobx 4 的迁移指南。</p><div style="text-align:center;"><img src="https://s1.ax1x.com/2020/05/31/t1kWMF.jpg" alt="封面"></div><p></p> <blockquote><p>翻译原文：<a href="https://github.com/mobxjs/mobx/wiki/Migrating-from-mobx-3-to-mobx-4" target="_blank" rel="noopener noreferrer">Migrating from mobx 3 to mobx 4 · mobxjs/mobx Wiki<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="变更概述"><a href="#变更概述" aria-hidden="true" class="header-anchor">#</a> 变更概述</h2> <p>非常抱歉，本迁移指南看起来如此的又大又长 😃，不过好消息是，可能您从未听说过本指南中提到的大多数变更。但是作为指南是需要无懈可击的，需要将它们全部列出。MobX 4 将会在运行时检测到大部分错误的/已弃用的 api 的使用情况，因此迁移的最简单的方法就是先升级，再根据本指南修复错误。如果您在项目中启用了TypeScript（或Flow），那么在编译时就会标记出来大多数不赞成使用的 api。</p> <p>MobX 4 删除了早在 MobX 3 中就已经弃用了的所有 api。因此，请确保在升级之前没有任何弃用警告: )。</p> <p><code>extras</code>命名空间被删除了，其中包含的所有的方法现在都在包顶层公开出来。这样可以使得 rollup 或 Webpack 等工具可以更好地进行 tree-shaking。</p> <p>MobX 4 针对生产环境与开发环境推出了单独的版本。在生产环境中将取消大多数类型检查，以生成运行更快，体积更小的版本。因此请确保在您的构建过程中不做<code>process.env.NODE_ENV = &quot;production&quot;</code>的设置！如果您是在 React项目中使用 MobX 的话，就可能已经做好了正确的配置。相关文档：<a href="https://zh-hans.reactjs.org/docs/add-react-to-a-website.html" target="_blank" rel="noopener noreferrer">在网站中添加 React – React<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p><code>observable.*</code> api 变得更加简化、一致。此外，现在可以在启用和禁用装饰器语法的情况下使用装饰器。80％到90％的 api 将与 MobX 3 保持一致，但是您还是需要对于某些边界情况做出一些调整。</p> <p>大多数 api 均已简化。例如，在以往许多 api 将会把第一个参数作为 <code>name</code>，其他额外的指标作为后续的参数。而现在几乎所有的 api 都已经改为将必需的参数优先传入，而后才是作为可选配置的对象。api 变得更简单易读了。</p> <p>对于 TypeScript 用户，在config中应将<code>tslib</code>设置为<code>es6</code>（编译的目标仍可以为ES5）。</p> <h2 id="已删除的内容"><a href="#已删除的内容" aria-hidden="true" class="header-anchor">#</a> 已删除的内容</h2> <p><em>注意：为了使  api 的体积更小，删除了许多已不准备支持的功能。如果您认为不应删除某些功能，请随时提出 issue！</em></p> <p><code>shareGlobalState</code>已被删除。现有的方法已经足以正确地设置项目 MobX 共享: )。</p> <p><code>autorun</code>，<code>reaction</code>，<code>runInAction</code>等方法不再支持接受<code>context</code> 参数（<code>this</code>）。请改用箭头函数代替。</p> <p><code>isModifierDescriptor</code>、<code>isStrictModeEnabled</code>、<code>extras.spyReport</code>、<code>extras.spyReportEnd</code>、<code>extras.spyReportStart</code>、<code>extras.isSpyEnabled</code>等方法将不复存在。</p> <p><code>whyRun</code>已被删除，请改用更简洁的 <a href="https://cn.mobx.js.org/best/trace.html" target="_blank" rel="noopener noreferrer">trace<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法。</p> <p>mobx 的 <code>default</code> 导出将不再公开。这意味着您不能再通过<code>import mobx from &quot;mobx&quot;</code>的方式引入 mobx，而是显式地导入内容：<code>import { observable } from &quot;mobx&quot;</code>。（或使用<code>import * as mobx from &quot;mobx&quot;</code>并终止 tree-shaking）。</p> <h2 id="已迁移的内容"><a href="#已迁移的内容" aria-hidden="true" class="header-anchor">#</a> 已迁移的内容</h2> <p>许多方法已经从<code>extras</code>命名空间中转移了。下列 api 中，带有_前缀的仍然是非官方的api（但可以用于测试），无前缀的方法现已正式支持。</p> <table><thead><tr><th style="text-align:center;">旧API</th> <th style="text-align:center;">新API</th></tr></thead> <tbody><tr><td style="text-align:center;"><code>useStrict(boolean)</code></td> <td style="text-align:center;"><code>configure({ enforceActions: boolean })</code></td></tr> <tr><td style="text-align:center;"><code>expr</code></td> <td style="text-align:center;">现在是<code>mobx-utils</code>包的一部分</td></tr> <tr><td style="text-align:center;"><code>createTransformer</code></td> <td style="text-align:center;">现在是<code>mobx-utils</code>包的一部分</td></tr> <tr><td style="text-align:center;"><code>map(values)</code></td> <td style="text-align:center;"><code>observable.map(values)</code></td></tr> <tr><td style="text-align:center;"><code>extras.allowStateChanges</code></td> <td style="text-align:center;"><code>_allowStateChanges</code></td></tr> <tr><td style="text-align:center;"><code>extras.deepEqual</code></td> <td style="text-align:center;"><code>comparer.structural</code></td></tr> <tr><td style="text-align:center;"><code>extras.getAdministration</code></td> <td style="text-align:center;"><code>getAdministration</code></td></tr> <tr><td style="text-align:center;"><code>extras.getAtom</code></td> <td style="text-align:center;"><code>getAtom</code></td></tr> <tr><td style="text-align:center;"><code>extras.getDebugName</code></td> <td style="text-align:center;"><code>getDebugName</code></td></tr> <tr><td style="text-align:center;"><code>extras.getDependencyTree</code></td> <td style="text-align:center;"><code>getDependencyTree</code></td></tr> <tr><td style="text-align:center;"><code>extras.getGlobalState</code></td> <td style="text-align:center;"><code>_getGlobalState</code></td></tr> <tr><td style="text-align:center;"><code>extras.getObserverTree</code></td> <td style="text-align:center;"><code>getObserverTree</code></td></tr> <tr><td style="text-align:center;"><code>extras.interceptReads</code></td> <td style="text-align:center;"><code>_interceptReads</code></td></tr> <tr><td style="text-align:center;"><code>extras.isComputingDerivation</code></td> <td style="text-align:center;"><code>_isComputingDerivation</code></td></tr> <tr><td style="text-align:center;"><code>extras.isolateGlobalState()</code></td> <td style="text-align:center;"><code>configure({ isolateGlobalState: true })</code></td></tr> <tr><td style="text-align:center;"><code>extras.onReactionError</code></td> <td style="text-align:center;"><code>onReactionError</code></td></tr> <tr><td style="text-align:center;"><code>extras.reserveArrayBuffer(number)</code></td> <td style="text-align:center;"><code>configure({ arrayBuffer: number })</code></td></tr> <tr><td style="text-align:center;"><code>extras.resetGlobalState</code></td> <td style="text-align:center;"><code>_resetGlobalState</code></td></tr> <tr><td style="text-align:center;"><code>extras.setReactionScheduler(fn)</code></td> <td style="text-align:center;"><code>configure({ reactionScheduler : fn })</code></td></tr></tbody></table> <h2 id="发生改变的内容"><a href="#发生改变的内容" aria-hidden="true" class="header-anchor">#</a> 发生改变的内容</h2> <h3 id="不使用装饰器语法（-）的装饰器"><a href="#不使用装饰器语法（-）的装饰器" aria-hidden="true" class="header-anchor">#</a> 不使用装饰器语法（@）的装饰器</h3> <p><code>observable.ref</code>，<code>observable.shallow</code>，<code>observable.deep</code>，<code>observable.struct</code>等装饰器方法不再被用作为函数使用，而是通过始终用装饰器的方式使用这些 api，令其更加一致。例如，<code>observable.object</code>和<code>extendObservable</code>现在支持一个<code>decorators</code>参数用于接受装饰器。</p> <p>其中 Mobx 3 中的装饰器方法，在 Mobx 4 应该改为使用 decorators 参数。例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// MobX 3</span>
<span class="token keyword">const</span> myObject <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;Michel&quot;</span><span class="token punctuation">,</span>
  profile<span class="token punctuation">:</span> observable<span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span>someDataFetchingPromise<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// MobX 4</span>
<span class="token keyword">const</span> myObject <span class="token operator">=</span> <span class="token function">observable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;Michel&quot;</span><span class="token punctuation">,</span>
  profile<span class="token punctuation">:</span> someDataFetchingPromise
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 指定装饰器.。默认值为'observable'，因此我们只指定了'profile':</span>
  profile<span class="token punctuation">:</span> observable<span class="token punctuation">.</span>ref   <span class="token comment">// 注意：不要加 () !</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>这种方法的优点是，现在使用<code>@decorator</code>与<code>decorator</code>的效果一致的，两种方式调用方式和接收参数始终相同。例如，下面的几个示例都实现了相同的效果。值得注意的是，切换不同的语法或创建对象的方式是非常方便的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
    @observable title <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span>
    @observable<span class="token punctuation">.</span>ref promise <span class="token operator">=</span> somePromise

    @computed <span class="token keyword">get</span> <span class="token function">difficulty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
    @<span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span> requiresReaction<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">get</span> <span class="token function">expensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">somethingExpensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    @action <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span>
    @action<span class="token punctuation">.</span>bound <span class="token function">setTitle2</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// observable.object 使用第二个参数 'decorators'，指定需要使用的装饰器。</span>
<span class="token comment">// 对于省略的属性，默认为 `observable` (getters 属性默认为`computed`)</span>
<span class="token keyword">const</span> todo <span class="token operator">=</span> observable<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    promise<span class="token punctuation">:</span> somePromise<span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">difficulty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">expensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">somethingExpensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">setTitle2</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// title: observable 可以省略，当 observable.object / extendobservable 时其将作为默认值。</span>
    ref<span class="token punctuation">:</span> observable<span class="token punctuation">.</span>ref<span class="token punctuation">,</span>
    expensive<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span> requiresReaction<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setTitle<span class="token punctuation">:</span> action<span class="token punctuation">,</span>
    setTitle2<span class="token punctuation">:</span> action<span class="token punctuation">.</span>bound
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 也许您的项目中已经有类，但还没有启用装饰器语法。不用担心，使用 MobX 4 可以让您不走回头路</span>
<span class="token comment">// 作为在 constructor 中使用`extendObservable`的替代，只需要在`mobx.decorate`中声明相关字段即可增强原型:</span>
<span class="token keyword">class</span> <span class="token class-name">Todo</span> <span class="token punctuation">{</span>
    title <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span>
    promise <span class="token operator">=</span> somePromise

    <span class="token keyword">get</span> <span class="token function">difficulty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">.</span>length
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">expensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">somethingExpensive</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span>
    <span class="token function">setTitle2</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> t
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">decorate</span><span class="token punctuation">(</span>Todo<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    title<span class="token punctuation">:</span> observable<span class="token punctuation">,</span>
    ref<span class="token punctuation">:</span> observable<span class="token punctuation">.</span>ref<span class="token punctuation">,</span>
    expensive<span class="token punctuation">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span> requiresReaction<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    setTitle<span class="token punctuation">:</span> action<span class="token punctuation">,</span>
    setTitle2<span class="token punctuation">:</span> action<span class="token punctuation">.</span>bound
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h3 id="可观察的工厂函数已经被清除"><a href="#可观察的工厂函数已经被清除" aria-hidden="true" class="header-anchor">#</a> 可观察的工厂函数已经被清除</h3> <table><thead><tr><th>旧API</th> <th>新API</th> <th>注释</th></tr></thead> <tbody><tr><td><code>observable(primitive value)</code></td> <td><code>observable.box(primitive value)</code></td> <td>由于装饰器@observable仍然可以正常工作（也适用于原始值）。如果该值为纯对象，数组或ES6 Map，observable(value)也可以正常使用</td></tr> <tr><td><code>observable(class instance)</code></td> <td><code>observable.box(class instance)</code></td> <td>由于装饰器@observable仍然可以正常工作（也适用于原始值）。如果该值为纯对象，数组或ES6 Map，observable(value)也可以正常使用</td></tr> <tr><td><code>observable.shallowArray(values)</code></td> <td><code>observable.array(values, { deep: false })</code></td> <td></td></tr> <tr><td><code>observable.shallowMap(values)</code></td> <td><code>observable.map(values, { deep: false })</code></td> <td></td></tr> <tr><td><code>observable.shallowObject(values)</code></td> <td><code>observable.object(values, {}, { deep: false })</code></td> <td>注意需要将空对象作为第二个参数，其中可以包含装饰器（请参见上文）</td></tr> <tr><td><code>extendObservable(target, props, moreProps, evenMoreProps)</code></td> <td><code>extendObservable(target, {...props, ...moreProps, ...evenMoreProps})</code></td> <td>extendObservable不再接受多个参数。而是先合并到一个对象中再解构赋值。</td></tr> <tr><td><code>extendShallowObservable(target, props)</code></td> <td><code>extendObservable(target, props, {}, { deep: false })</code></td> <td>注意需要将空对象作为第三个参数，其中可以包含装饰器（请参见发行说明）</td></tr> <tr><td><code>@computed.equals(compareFn)</code></td> <td><code>@computed({ equals: compareFn })</code></td> <td></td></tr> <tr><td><code>autorunAsync(fn, delay)</code></td> <td><code>autorun(fn, { delay: delay })</code></td> <td></td></tr> <tr><td><code>autorun(name, fn)</code></td> <td><code>autorun(fn, { name: name })</code></td> <td></td></tr> <tr><td><code>when(name, predicate, effect)</code></td> <td><code>when(predicate, effect, { name: name })</code></td> <td></td></tr> <tr><td><code>reaction(name, expr, effect)</code></td> <td><code>reaction(expr, effect, { name: name })</code></td> <td></td></tr> <tr><td><code>isComputed(thing, prop)</code></td> <td><code>isComputedProp(thing, prop)</code></td> <td>isComputed(thing) 仍然可以正常使用</td></tr> <tr><td><code>isObservable(thing, prop)</code></td> <td><code>isObservableProp(thing, prop)</code></td> <td>isObservable(thing) 仍然可以正常使用</td></tr> <tr><td><code>new Atom(name, fn, fn)</code></td> <td><code>createAtom(name, fn, fn)</code></td> <td>Atom 类不再直接从包中公开。需要注意的是，现在存在可以在任何MobX可观察对象上使用的全局函数onBecomeObserved并且onBecomeUnobserved，因此在许多情况下，您可能根本不需要创建Atom 的实例。</td></tr> <tr><td><code>computed(fn, { struct: true }) / computed(fn, { compareStructural: true })</code></td> <td><code>computed(fn, { equals: comparer.structural })</code></td> <td></td></tr></tbody></table> <h2 id="其他改动"><a href="#其他改动" aria-hidden="true" class="header-anchor">#</a> 其他改动</h2> <p>MobX 现在需要<code>Map</code>在全局范围内可用，因此需要确保在旧版浏览器中的兼容性（目前支持的是IE 10及更高版本）。如果您使用了<code>observable.map()</code>和序列化，可能需要更新代码。 <code>observableMap.toJS()</code>现在会返回一个<code>Map</code>的普通实例。如果希望转换为普通 JavaScript 对象，请使用<code>observableMap.toJSON()</code></p> <p><code>extendObservable</code>不能再重新声明现有属性，只能引入新属性。应该改用<code>set</code>引入新属性或更新现有属性</p> <p>所有可迭代的对象都不再创建数组作为迭代器，而只是创建一个真正的迭代器，以求与官方规范更加紧密地对齐。因此，以前的<code>observableMap.values()</code>将返回一个数组作为迭代器，但是现在它将只返回一个迭代器。所以你不能再做类似<code>observableMap.values().map(fn)</code>的操作。而是使用<code>Array.from(observableMap.values()).map(fn)</code>或<code>mobx.values(observableMap).map(fn)</code>。受影响的迭代器有：1.可观察数组的默认迭代器。2.可观察映射的默认迭代器。包括<code>observableMap.entries()</code>，<code>observableMap.keys()</code>和<code>observableMap.values()</code>。</p> <p>传递给<code>spy</code>处理函数的参数已稍作更改。</p> <p>如果<code>reportObserved</code>在反应性上下文之外被触发，在自建 atom 中调用<code>reportObserved()</code>将不再触发钩子。</p></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">5/31/2020, 3:25:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/2005/20200528A.html" class="prev">
          【翻译】MobX 4：更优秀、简易、快捷、轻便
        </a></span> <span class="next"><a href="/2004/20200409A.html">
          【归纳】ES6 新增的数据类型
        </a>
        →
      </span></p></div> </main> <div class="valine-wrapper" data-v-5029e45b><div id="valine" data-v-5029e45b></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.20586f85.js" defer></script><script src="/assets/js/3.a975d71c.js" defer></script><script src="/assets/js/1.f9715dde.js" defer></script><script src="/assets/js/117.2b92a260.js" defer></script>
  </body>
</html>
