(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{426:function(t,s,a){"use strict";a.r(s);var n=a(40),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"tip custom-block"},[a("p",[t._v("转眼间这个月就到了月末，从庐山回来到现在天天都来公司上班，都没停下来过，博客和课程都没什么心思看。这篇文章是在上个月末比较空闲的翻的关于 Mobx 4 的一篇文章。在工作之前，自己几乎没有接触过 Mobx，只是在工作使用中不断边学边用，现在也只能说是一知半解。虽然现在只是为了准备项目的 Mobx 升级才翻的几篇文章，不过借助这几篇文章的翻译，也算是帮助了我学习了不少 Mobx 的知识。")])]),t._v(" "),a("p",[t._v("这篇文章是 Mobx 作者写的一篇关于 Mobx 4 的介绍，概括了 Mobx 4 中的重要更新内容。")]),a("div",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/05/28/teslge.jpg",alt:"封面"}})]),a("p"),t._v(" "),a("blockquote",[a("p",[t._v("翻译原文："),a("a",{attrs:{href:"https://medium.com/@mweststrate/mobx-4-better-simpler-faster-smaller-c1fbc08008da",target:"_blank",rel:"noopener noreferrer"}},[t._v("MobX 4: Better, simpler, faster, smaller - Michel Weststrate - Medium"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("而且，Mobx 5 将会更加出色😺")]),t._v(" "),a("p",[t._v("在这里我可以很自豪地宣布，新的"),a("a",{attrs:{href:"https://mobx.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MobX"),a("OutboundLink")],1),t._v("大版本已经发布！版本更新"),a("a",{attrs:{href:"https://github.com/mobxjs/mobx/blob/master/CHANGELOG.md#400",target:"_blank",rel:"noopener noreferrer"}},[t._v("日志"),a("OutboundLink")],1),t._v("相当长，其中还包含一份"),a("a",{attrs:{href:"https://github.com/mobxjs/mobx/wiki/Migrating-from-mobx-3-to-mobx-4",target:"_blank",rel:"noopener noreferrer"}},[t._v("迁移指南"),a("OutboundLink")],1),t._v("。因此，在本篇博客中我将重点介绍一些值得关注的新功能。顺便说一句，如果您还不熟悉 MobX，可以留意一下免费的 "),a("a",{attrs:{href:"https://egghead.io/courses/manage-complex-state-in-react-apps-with-mobx",target:"_blank",rel:"noopener noreferrer"}},[t._v("egghead.io"),a("OutboundLink")],1),t._v(" 课程！")]),t._v(" "),a("h2",{attrs:{id:"本文大纲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本文大纲","aria-hidden":"true"}},[t._v("#")]),t._v(" 本文大纲")]),t._v(" "),a("ul",[a("li",[t._v("没有装饰器语法（@）的装饰器")]),t._v(" "),a("li",[t._v("动态扩展可观察对象")]),t._v(" "),a("li",[t._v("await when和flow进一步了简化异步进程")]),t._v(" "),a("li",[t._v("使用onBecome(Un)Observed自动获取数据源")]),t._v(" "),a("li",[t._v("专用于生产环境的更小、更快的版本")])]),t._v(" "),a("p",[t._v("本篇博客中提到的所有新功能，在下文引用的 "),a("a",{attrs:{href:"https://codesandbox.io/s/l73yprwj9z",target:"_blank",rel:"noopener noreferrer"}},[t._v("code sandbox"),a("OutboundLink")],1),t._v(" 页面中都进行了演示，请务必留意！")]),t._v(" "),a("h2",{attrs:{id:"没有装饰器语法（-）的装饰器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#没有装饰器语法（-）的装饰器","aria-hidden":"true"}},[t._v("#")]),t._v(" 没有装饰器语法（@）的装饰器")]),t._v(" "),a("p",[t._v("大多数 MobX 用户都使用了处于 Stage-2 提案阶段的装饰器语法，这种语法可以生成简单、易读的声明性代码。然而，由于该语法尚未标准化，部分用户并不乐于使用装饰器语法（不过该提案已经取得很大进展，"),a("a",{attrs:{href:"https://github.com/tc39/proposal-decorators/blob/master/previous/METAPROGRAMMING.md#metaprogramming-with-decorators",target:"_blank",rel:"noopener noreferrer"}},[t._v("很有希望"),a("OutboundLink")],1),t._v("正式通过！）。例如，create-react-app 出于充分的理由，并不支持开箱即用的装饰器。")]),t._v(" "),a("p",[t._v("MobX 4 引入了一个名为"),a("code",[t._v("decorate")]),t._v("的新 api。您可以借此使用装饰器，而且无需使用装饰器语法。直接用上代码比用文字解释更为直观，正如下例所示：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" decorate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flow "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mobx"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n 使用装饰器语法\n*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("City")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    @observable location\n    @observable temperature\n\n    @action"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bound\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchTemperature")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* implementation */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n 没有使用装饰器语法\n*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("City")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location\n    temperature\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchTemperature")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* implementation */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decorate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("City"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    temperature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    fetchTemperature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" action"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bound\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br")])]),a("div",{staticStyle:{"text-align":"center","font-weight":"bold"}},[t._v("现在可以不依赖于装饰器语法使用装饰器")]),t._v(" "),a("p",[t._v("这样做的好处是，现在可以在 MobX API 的其他位置使用装饰器。过去，可以通过将“神奇”的封装对象，例如"),a("code",[t._v("observable.ref(some value)")]),t._v("传递给"),a("code",[t._v("observable.object")]),t._v("或"),a("code",[t._v("extendObservable")]),t._v("，从而使得特定的行为可以被附加到可观察的属性上。但是在 MobX 4中，您只需可以简单地传递一系列装饰器作为附加参数即可。")]),t._v(" "),a("p",[t._v("无论是否借助装饰器语法，都可以灵活地使用装饰器的功能。实际上，这两种方式现在的唯一区别只有语法而已。新的 API 也让使用不太常见的对象扩展方法成为可能，就像"),a("code",[t._v("Object.create")]),t._v("声明原型一样来定义可观察属性。")]),t._v(" "),a("h2",{attrs:{id:"动态扩展可观察对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态扩展可观察对象","aria-hidden":"true"}},[t._v("#")]),t._v(" 动态扩展可观察对象")]),t._v(" "),a("p",[t._v("MobX 4 是 MobX 5 的基石。由于在 MobX 5 中将改用使用 Proxy 来实现可观察对象和数组，并消除了由于 ES 5 的限制而引起的已知警告。因此，MobX 4 的目标是尽可能表现得像 MobX 5 一样。毫无疑问，将来人们将会有将 Mobx 的版本从 5 降级为 4 的需要，因为他们的应用程序在 Internet Explorer（不支持Proxy）之类的旧浏览器上将不能正常运行。")]),t._v(" "),a("p",[t._v("出于这个原因，在 Mobx 4 中可观察对象可以是动态的集合！为了实现这一点，MobX 4 受 Vue 启发，引入了一系列工具函数以便操作集合：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("keys(object)")]),t._v("返回对象的所有可观察属性的名称，类似于"),a("code",[t._v("Object.keys(object)")]),t._v("。")]),t._v(" "),a("li",[a("code",[t._v("values(object)")]),t._v(" 返回对象的所有可观察属性的值。")]),t._v(" "),a("li",[a("code",[t._v("set(object, key, value)")]),t._v("或"),a("code",[t._v("set(object, keyValueMap)")]),t._v("将更新对象中所有指定的属性或添加新属性。")]),t._v(" "),a("li",[a("code",[t._v("remove(object, key)")]),t._v("。猜一下吧。")]),t._v(" "),a("li",[a("code",[t._v("get(object, key)")]),t._v("。返回对象中指定键下的属性值。您可能并不会经常使用它，但是此 API 的优势在于可以跟踪到尚不存在的属性值！")]),t._v(" "),a("li",[a("code",[t._v("has(object, key)")]),t._v("。返回 key 是否为可观察的属性。同样地，它将跟踪这个属性，因此您也可以借此检查尚不存在的属性。")])]),t._v(" "),a("p",[t._v("Map 与数组都可以使用这些函数。请注意，并不是让您必须要使用这些工具函数。不过，如果您愿意使用keys或values迭代对象，并使用set动态添加属性，MobX 就能够跟踪任何将来的属性添加并做出反应。")]),t._v(" "),a("p",[t._v("顺便说一句，我个人建议仍将可观察的 Map 作为动态集合使用，这样在类型上也显得更为整洁。并且它可以让其他人更清楚地明白您的数据结构的意义。")]),t._v(" "),a("p",[t._v("另一个值得注意的变化是，可观察的 Map 现在由真实的 Map 支持，这意味着可观察的 Map 现在支持任意值作为键，而不仅仅是在 MobX 3 时只能由字符串或数字作为键。")]),t._v(" "),a("h2",{attrs:{id:"改进了对异步进程的支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改进了对异步进程的支持","aria-hidden":"true"}},[t._v("#")]),t._v(" 改进了对异步进程的支持")]),t._v(" "),a("p",[t._v("尽管可以在异步进程中直接使用，已经是 Mobx 的强项之一，MobX 4 仍然能够使一些常见的情形更加便捷。")]),t._v(" "),a("p",[t._v("例如，"),a("a",{attrs:{href:"https://github.com/mobxjs/mobx-utils",target:"_blank",rel:"noopener noreferrer"}},[t._v("mobx-utils"),a("OutboundLink")],1),t._v(" 包中的两个工具函数，"),a("code",[t._v("whenWithTimeout")]),t._v("而"),a("code",[t._v("whenAsync")]),t._v("现在已合并到核心 API 中。这意味着当您调用了"),a("code",[t._v("when")]),t._v("但未传入 "),a("code",[t._v("effect")]),t._v(" 参数时，它将自动返回您可以的"),a("code",[t._v("await")]),t._v("的 promise 。您可以选择为此 promise 设置延时甚至"),a("code",[t._v(".cancel()")]),t._v("它！")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" when "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mobx"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loggedOut"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You have been successfully logged out!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("在"),a("code",[t._v("strict")]),t._v("模式下使用 MobX 时，具有大量回调的异步进程可能显得不够灵活，因为每个更改状态的回调都需要包装在"),a("code",[t._v("action")]),t._v("（或"),a("code",[t._v("runInAction")]),t._v("）中。为此，工具函数"),a("code",[t._v("asyncAction")]),t._v("已从 mobx-utils 包移至主包，"),a("code",[t._v("flow")]),t._v("也是在主包中导出。")]),t._v(" "),a("p",[a("code",[t._v("flow")]),t._v("在底层是使用的是生成器（generator），虽然看起来可能有点唬人，但在语义上是等效于"),a("code",[t._v("async / await")]),t._v("的，只需要将"),a("code",[t._v("async fn() {}")]),t._v("替换为"),a("code",[t._v("*fn() {}")]),t._v("、"),a("code",[t._v("await <promise>")]),t._v("替换为"),a("code",[t._v("yield <promise>")]),t._v("就可以了。下文示例中的"),a("code",[t._v("City")]),t._v("就可以很好地说明了这一点。")]),t._v(" "),a("p",[t._v("使用生成器的好处是，我们可以自动将流程的每个步骤依次包装为一个动作。此外还有一些有趣的特性，比如 flow 是可取消的（只需调用返回的Promise上的"),a("code",[t._v(".cancel()")]),t._v("），而且支持形如"),a("code",[t._v("flow(async *function() { })")]),t._v("的异步生成器。")]),t._v(" "),a("p",[t._v("您可以查看@leighchalliday的"),a("a",{attrs:{href:"https://cdn.embedly.com/widgets/media.html?type=text%2Fhtml&key=a19fcc184b9711e1b4764040d3dc5c07&schema=twitter&url=https%3A//twitter.com/leighchalliday/status/972596890616377344&image=https%3A//i.embed.ly/1/image%3Furl%3Dhttps%253A%252F%252Fpbs.twimg.com%252Fprofile_images%252F527868739207708672%252FquLiBx7p_400x400.jpeg%26key%3Da19fcc184b9711e1b4764040d3dc5c07",target:"_blank",rel:"noopener noreferrer"}},[t._v("此视频/文章"),a("OutboundLink")],1),t._v("，了解有关 flow 的更多信息。")]),t._v(" "),a("p",[t._v("需要注意的是，尽量地将状态的突变推迟到异步进程的最后，使应用程序在异步进程中有更少不同的状态，仍然是最佳实践。")]),t._v(" "),a("h2",{attrs:{id:"资源管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源管理","aria-hidden":"true"}},[t._v("#")]),t._v(" 资源管理")]),t._v(" "),a("p",[t._v("Mobx 4 中终于引入了一些人们期待已久的钩子！例如"),a("code",[t._v("onBecomeObserved")]),t._v("和"),a("code",[t._v("onBecomeUnobserved")]),t._v("，这些钩子可用于任何可观察的集合或属性，并且可以检测到 MobX 是从何时开始或停止跟踪这些可观察对象的。例如，您可以使用此功能自动开始跟踪远程数据源，但是仅是组件需要这个值的时候才可以这样做。")]),t._v(" "),a("p",[t._v("在下面的示例中，页面将自动获取一些城市的天气，并每隔几秒钟刷新一次该信息。不过，由于该演示把不同城市做了分页，因此我们只希望获取当前页面展示的城市的数据。利用这些钩子可以轻松实现这个效果。")]),t._v(" "),a("p",[t._v("code sandbox 实例链接："),a("a",{attrs:{href:"https://codesandbox.io/s/l73yprwj9z?from-embed",target:"_blank",rel:"noopener noreferrer"}},[t._v("MobX 4 demo project - CodeSandbox"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("下面的代码块是 City 类的完整定义。值得注意的是，它使用了许多 MobX 的新功能：")]),t._v(" "),a("ul",[a("li",[t._v("一个"),a("code",[t._v("flow")]),t._v("创建了一个异步的进程，来获取气象数据及处理错误。")]),t._v(" "),a("li",[t._v("无需使用装饰器语法，使用"),a("code",[t._v("decorate")]),t._v("即可标记必要的字段为"),a("code",[t._v("observable")]),t._v("或"),a("code",[t._v("flow")]),t._v("。")]),t._v(" "),a("li",[t._v("借助"),a("code",[t._v("onBecomeObserved")]),t._v("/ "),a("code",[t._v("onBecomeUnobserved")]),t._v("，可以使组件在开始/停止跟踪"),a("code",[t._v("temperature")]),t._v("属性时​​，立即自动恢复/暂停订阅天气 API 的数据。")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" decorate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" flow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onBecomeObserved"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onBecomeUnobserved "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mobx'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" log "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./log'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APPID")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<secret>'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("City")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location\n    temperature\n    interval\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" location\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 仅在实际使用 temperature 属性的情况下才开始获取数据！")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBecomeObserved")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'temperature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("resume"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBecomeUnobserved")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'temperature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("suspend"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("resume")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Resuming ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interval "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetchTemperature")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("suspend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Suspending ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temperature "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("interval"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一个异步的 flow")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请注意，它的工作方式类似于async / await，但语法不同")]),t._v("\n    fetchTemperature "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flow")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("https://api.openweathermap.org/data/2.5/weather?appid=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("APPID")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("&q=")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" json "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temperature "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("round")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("273.15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Temperature in ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(": ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temperature"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Failed to fetch temperature: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("e"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用装饰器的功能但不使用装饰器语法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("decorate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("City"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" observable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    temperature"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" observable\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br")])]),a("p",[t._v("如下面的代码所示，凭借着这些新功能，我们的"),a("code",[t._v("CityView")]),t._v("组件甚至不需要去感知所需的数据获取，因此看起来显得非常小，已经无需增加任何其他逻辑！有一点需要注意的是，如果直接将"),a("code",[t._v("city.temperature")]),t._v("从该组件中删除，将会导致"),a("code",[t._v("City")]),t._v("类变得完全无法开始获取数据🎉。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" CityView "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" city "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        City"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" Temperature "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" ℃"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("temperature "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Loading'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("h2",{attrs:{id:"更快捷、轻便"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更快捷、轻便","aria-hidden":"true"}},[t._v("#")]),t._v(" 更快捷、轻便")]),t._v(" "),a("p",[t._v("MobX 4 针对生产环境与开发环境推出了单独的版本。通过去除大量的一致性和 API 使用检查，可以使得用于生产环境的 MobX 更小、更快。可以通过引用 CDN 的"),a("code",[t._v(".min.js")]),t._v("版本来生产版本，或者是取消"),a("code",[t._v('process.env.NODE_ENV与"production"')]),t._v("之间的绑定。这与 React 所使用的机制完全相同，因此，如果您的 React 构建已经正确设置，则无需再进行任何其他操作！")]),t._v(" "),a("p",[t._v("不管怎样，下面的一些统计数据可以作为参考：")]),t._v(" "),a("ul",[a("li",[t._v("MobX 4 与 MobX 3 相比，测试套件性能提高了14％。")]),t._v(" "),a("li",[t._v("压缩后的最小构建大小从 17.3kB 降至 14.2kB（缩小了22％）。而且，由于 MobX 4 可以更好地进行 tree-shaking，因此实际上可以将体积压缩的甚至更小。")])]),t._v(" "),a("h2",{attrs:{id:"更多"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多","aria-hidden":"true"}},[t._v("#")]),t._v(" 更多")]),t._v(" "),a("p",[t._v("虽然上面所提到的新功能并非所有的更新内容，但也是其中最有趣的部分。可以通过请查阅完整的"),a("a",{attrs:{href:"https://github.com/mobxjs/mobx/blob/master/CHANGELOG.md#400",target:"_blank",rel:"noopener noreferrer"}},[t._v("变更日志"),a("OutboundLink")],1),t._v("了解其他遗珠。")]),a("div",{staticStyle:{"text-align":"center"}},[a("img",{attrs:{src:"https://s1.ax1x.com/2020/05/28/te6WX4.png",alt:"在做重大改动需要集中精力"}})]),t._v(" "),a("div",{staticStyle:{"text-align":"center","font-weight":"bold"}},[t._v("在做重大改动时需要集中精力:) monkeyuser.com\n")]),a("p"),t._v(" "),a("p",[t._v("MobX 是一个开源项目。凭借着 "),a("a",{attrs:{href:"https://www.mendix.com/careers/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mendix"),a("OutboundLink")],1),t._v(" 对 MobX 维护非常慷慨地鼎力相助，实际上我只花了几个星期的时间来开发 MobX 4 和 5（希望能在几周内完成）。可以顺利开发完成主要原因是，我能够心无旁骛地专注于在 MobX 的工作，从而去实现一些重大改动！")]),t._v(" "),a("p",[t._v("因此，如果 MobX 在过去为您节省了大量的精力，并因此节省了金钱。请考虑赞助它的发展！谢谢！🍻")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://opencollective.com/mobx",target:"_blank",rel:"noopener noreferrer"}},[t._v("MobX 的 open collective"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.patreon.com/mweststrate",target:"_blank",rel:"noopener noreferrer"}},[t._v("Patreon"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.paypal.me/michelweststrate",target:"_blank",rel:"noopener noreferrer"}},[t._v("Paypal"),a("OutboundLink")],1),t._v("（是的，Marinus Cornelis是我的真实姓名🎃）")])])])},[],!1,null,null,null);s.default=e.exports}}]);